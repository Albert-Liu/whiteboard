<%= form_for(@job) do |f| %>
  <% if @job.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@job.errors.count, "error") %> prohibited this job from being saved:</h2>

      <ul>
      <% @job.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :title %><br />
    <%= f.text_field :title %>
  </div>
  <div class="field">
    <%= f.label :description %><br />
    <%= f.text_area :description %>
  </div>
  <div class="field">
    <%= f.label :skills_must_haves %><br />
    <%= f.text_field :skills_must_haves %>
  </div>
  <div class="field">
    <%= f.label :skills_nice_haves %><br />
    <%= f.text_field :skills_nice_haves %>
  </div>
  <div class="field">
    <%= f.label :duration %><br />
    <%= f.text_field :duration %>
  </div>

    <div id="supervisors_in_a_collection" data-member-label="Supervisor">
      <p>Contact people: </p>

      <% if @job.supervisors_override.nil? %>
          <%= render :partial => '/people/person_in_a_collection', :collection => @job.supervisors.map(&:human_name), :as => :person, :locals => {:collection_form => f, :member_label => "Supervisor"} %>
      <% else %>
          <%= render :partial => '/people/person_in_a_collection', :collection => @job.supervisors_override, :as => :person, :locals => {:collection_form => f, :member_label => "Supervisor"} %>
      <% end %>
    </div>

    <div class="formItem indented"><p><%= link_to "Add a supervisor", "#", :class => "add_person" %></p></div>


    <div id="employees_in_a_collection" data-member-label="Student">
      <p>Assigned students: </p>

      <% if @job.employees_override.nil? %>
          <%= render :partial => '/people/person_in_a_collection', :collection => @job.employees.map(&:human_name), :as => :person, :locals => {:collection_form => f, :member_label => "Student"} %>
      <% else %>
          <%= render :partial => '/people/person_in_a_collection', :collection => @job.employees_override, :as => :person, :locals => {:collection_form => f, :member_label => "Student"} %>
      <% end %>
    </div>

    <div class="formItem indented"><p><%= link_to "Add a student", "#", :class => "add_person" %></p></div>


  <div class="field">
    <%= f.label :funding_source %><br />
    <%= f.text_field :funding_source %>
  </div>
  <div class="field">
    <%= f.label :funding_oracle_string %><br />
    <%= f.text_field :funding_oracle_string %>
  </div>
  <div class="field">
    <%= f.label :is_accepting %><br />
    <%= f.check_box :is_accepting %>
  </div>
  <div class="field">
    <%= f.label :is_closed %><br />
    <%= f.check_box :is_closed %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>


<%# content_for :javascript do %>
    <%# javascript_tag do %>
    <script type="text/javascript">
        $(function () {

            $(".add_person").click(function (event) {
                event.preventDefault();
                var $people_in_collection = $(this).parent().parent().prev();
                var member_label = $people_in_collection.attr("data-member-label");
                $people_in_collection.append("<%= escape_javascript(render(:partial => '/people/person_in_a_collection', :object => Person.new, :locals => { :member_label => "Person"} )) %>");
                $people_in_collection.last().find(".person_in_a_collection:last .member-label").html(member_label);
                $people_in_collection.last().find(".person_in_a_collection:last input").attr("name",  member_label.toLowerCase() + "s[]");
            });

        });
    </script>
    <%# end %>
<%# end %>
