<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: PeopleController [Rails Application Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          PeopleController
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/app/controllers/people_controller_rb.html">app/controllers/people_controller.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="ApplicationController.html">ApplicationController</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000024">create</a></li>
              <li><a href="#M000028">destroy</a></li>
              <li><a href="#M000023">edit</a></li>
              <li><a href="#M000017">index</a></li>
              <li><a href="#M000029">my_teams</a></li>
              <li><a href="#M000022">new</a></li>
              <li><a href="#M000018">phone_book</a></li>
              <li><a href="#M000019">photo_book</a></li>
              <li><a href="#M000026">revert_to_version</a></li>
              <li><a href="#M000027">robots</a></li>
              <li><a href="#M000020">show</a></li>
              <li><a href="#M000021">show_by_twiki</a></li>
              <li><a href="#M000025">update</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000024'>
                <a name='M000024'></a>
                <div class='synopsis'>
                  <span class='name'>create</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  POST /people POST /people.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000024-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000024-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 137</span>&#x000A;137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>&#x000A;138:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_staff?</span>)&#x000A;139:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">&quot;You don't have permission to do this action.&quot;</span>&#x000A;140:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>&#x000A;141:     <span class="ruby-keyword kw">end</span>&#x000A;142: &#x000A;143:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:person</span>])&#x000A;144:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">updated_by_user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>&#x000A;145:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">image_uri</span> = <span class="ruby-value str">&quot;/images/mascot.jpg&quot;</span>&#x000A;146: &#x000A;147:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A;148:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">save</span>&#x000A;149:         <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">create_google_email</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:create_google_email</span>]&#x000A;150:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:create_twiki_account</span>]&#x000A;151:           <span class="ruby-identifier">status</span> = <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">create_twiki_account</span> &#x000A;152:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">'TWiki account was not created.'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">status</span>&#x000A;153:         <span class="ruby-keyword kw">end</span>&#x000A;154: &#x000A;155:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Person was successfully created.'</span>&#x000A;156:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@person</span>) }&#x000A;157:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:created</span>, <span class="ruby-identifier">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span> }&#x000A;158:       <span class="ruby-keyword kw">else</span>&#x000A;159:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new&quot;</span> }&#x000A;160:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }&#x000A;161:       <span class="ruby-keyword kw">end</span>&#x000A;162:     <span class="ruby-keyword kw">end</span>&#x000A;163:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000028'>
                <a name='M000028'></a>
                <div class='synopsis'>
                  <span class='name'>destroy</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  DELETE /people/1 DELETE /people/1.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000028-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000028-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 201</span>&#x000A;201:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>&#x000A;202:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin?</span>&#x000A;203:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">'You don'</span><span class="ruby-value str">'t have permission to do this action.'</span>&#x000A;204:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>   &#x000A;205:     <span class="ruby-keyword kw">end</span>  &#x000A;206:       &#x000A;207:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;208:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">destroy</span>&#x000A;209: &#x000A;210:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A;211:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>) }&#x000A;212:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }&#x000A;213:     <span class="ruby-keyword kw">end</span>&#x000A;214:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000023'>
                <a name='M000023'></a>
                <div class='synopsis'>
                  <span class='name'>edit</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  GET /people/1/edit
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000023-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000023-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 126</span>&#x000A;126:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>&#x000A;127: <span class="ruby-comment cmt">#    if !(current_user.is_admin? || current_user.is_staff?)</span>&#x000A;128: <span class="ruby-comment cmt">#      flash[:error] = &quot;You don't have permission to do this action.&quot;</span>&#x000A;129: <span class="ruby-comment cmt">#      redirect_to(people_url) and return</span>&#x000A;130: <span class="ruby-comment cmt">#    end</span>&#x000A;131: &#x000A;132:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;133:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000017'>
                <a name='M000017'></a>
                <div class='synopsis'>
                  <span class='name'>index</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  GET /people GET /people.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000017-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000017-source'>    <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 15</span>&#x000A;15:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>&#x000A;16:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search</span>]&#x000A;17:           <span class="ruby-ivar">@people</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'human_name LIKE ?'</span>, <span class="ruby-node">&quot;%#{params[:search]}%&quot;</span>])&#x000A;18:     <span class="ruby-keyword kw">else</span>&#x000A;19:           <span class="ruby-ivar">@people</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'is_active IS TRUE'</span>],  <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;first_name ASC, last_name ASC&quot;</span>)&#x000A;20:     <span class="ruby-keyword kw">end</span>&#x000A;21:       &#x000A;22:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A;23: <span class="ruby-comment cmt">#      format.html # index.html.erb</span>&#x000A;24:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:html</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@people</span>, <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;cmu_sv&quot;</span> } <span class="ruby-comment cmt"># index.html.erb</span>&#x000A;25:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>   { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:js</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@people</span>, <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }&#x000A;26:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@people</span> }&#x000A;27:     <span class="ruby-keyword kw">end</span>&#x000A;28:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000029'>
                <a name='M000029'></a>
                <div class='synopsis'>
                  <span class='name'>my_teams</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000029-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000029-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 219</span>&#x000A;219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">my_teams</span>&#x000A;220:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;221:     <span class="ruby-identifier">person_id</span> = <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_i</span>&#x000A;222:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">person_id</span>)&#x000A;223:       <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_staff?</span>)<span class="ruby-operator">||</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin?</span>)&#x000A;224:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">'You don'</span><span class="ruby-value str">'t have permission to see another person'</span><span class="ruby-value str">'s teams.'</span>&#x000A;225:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>&#x000A;226:       <span class="ruby-keyword kw">end</span>&#x000A;227:     <span class="ruby-keyword kw">end</span>&#x000A;228:     <span class="ruby-ivar">@course</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">new</span>()&#x000A;229: &#x000A;230:     <span class="ruby-ivar">@current_year</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">year</span>()&#x000A;231:     <span class="ruby-ivar">@current_semester</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_semester</span>()&#x000A;232: &#x000A;233:     <span class="ruby-comment cmt">#SQL statements determined by Team Juran</span>&#x000A;234:     <span class="ruby-ivar">@current_teams_as_member</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;SELECT t.* FROM  teams t INNER JOIN teams_people tp ON ( t.id = tp.team_id) INNER JOIN users u ON (tp.person_id = u.id) INNER JOIN courses c ON (t.course_id = c.id) WHERE u.id = ? AND c.semester = ? AND c.year = ?&quot;</span>, <span class="ruby-identifier">person_id</span>, <span class="ruby-ivar">@current_semester</span>, <span class="ruby-ivar">@current_year</span>.<span class="ruby-identifier">to_s</span>])&#x000A;235:     <span class="ruby-ivar">@past_teams_as_member</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;SELECT t.* FROM  teams t INNER JOIN teams_people tp ON ( t.id = tp.team_id) INNER JOIN users u ON (tp.person_id = u.id) INNER JOIN courses c ON (t.course_id = c.id) WHERE u.id = ? AND (c.semester &lt;&gt; ? OR c.year &lt;&gt; ?)&quot;</span>, <span class="ruby-identifier">person_id</span>, <span class="ruby-ivar">@current_semester</span>, <span class="ruby-ivar">@current_year</span>.<span class="ruby-identifier">to_s</span>])&#x000A;236: &#x000A;237:     (<span class="ruby-ivar">@teams_map</span>, <span class="ruby-ivar">@teams_students_map</span>) = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">faculty_teams_map</span>(<span class="ruby-identifier">person_id</span>)&#x000A;238:     <span class="ruby-identifier">a</span> = <span class="ruby-value">10</span>&#x000A;239:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000022'>
                <a name='M000022'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  GET /people/new GET /people/new.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000022-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000022-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 110</span>&#x000A;110:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>&#x000A;111:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_staff?</span>)&#x000A;112:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">&quot;You don't have permission to do this action.&quot;</span>&#x000A;113:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>&#x000A;114:     <span class="ruby-keyword kw">end</span>&#x000A;115: &#x000A;116:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>&#x000A;117:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">is_active</span> = <span class="ruby-keyword kw">true</span>&#x000A;118: &#x000A;119:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A;120:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># new.html.erb</span>&#x000A;121:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span> }&#x000A;122:     <span class="ruby-keyword kw">end</span>&#x000A;123:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000018'>
                <a name='M000018'></a>
                <div class='synopsis'>
                  <span class='name'>phone_book</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000018-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000018-source'>    <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 30</span>&#x000A;30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">phone_book</span>&#x000A;31:     <span class="ruby-identifier">index</span>&#x000A;32:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000019'>
                <a name='M000019'></a>
                <div class='synopsis'>
                  <span class='name'>photo_book</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000019-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000019-source'>    <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 34</span>&#x000A;34:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">photo_book</span>&#x000A;35:     <span class="ruby-identifier">index</span>&#x000A;36:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000026'>
                <a name='M000026'></a>
                <div class='synopsis'>
                  <span class='name'>revert_to_version</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000026-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000026-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 188</span>&#x000A;188:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">revert_to_version</span>&#x000A;189:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>] )&#x000A;190:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">revert_to!</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:version_id</span>]&#x000A;191:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'show'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>&#x000A;192:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000027'>
                <a name='M000027'></a>
                <div class='synopsis'>
                  <span class='name'>robots</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000027-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000027-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 194</span>&#x000A;194:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">robots</span>&#x000A;195:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-value str">&quot;curriculum comment: robot detected&quot;</span>)&#x000A;196:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># index.html.erb</span>&#x000A;197:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000020'>
                <a name='M000020'></a>
                <div class='synopsis'>
                  <span class='name'>show</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  GET /people/1 GET /people/1.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000020-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000020-source'>    <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 41</span>&#x000A;41:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>&#x000A;42:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;43:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">revert_to</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:version_id</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:version_id</span>]&#x000A;44: &#x000A;45:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A;46:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">nil?</span>&#x000A;47:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-node">&quot;Person with an id of #{params[:id]} is not in this system.&quot;</span>&#x000A;48:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>)  }&#x000A;49:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }&#x000A;50:       <span class="ruby-keyword kw">else</span>&#x000A;51:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># show.html.erb</span>&#x000A;52:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span> }&#x000A;53:       <span class="ruby-keyword kw">end</span>&#x000A;54:     <span class="ruby-keyword kw">end</span>&#x000A;55:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000021'>
                <a name='M000021'></a>
                <div class='synopsis'>
                  <span class='name'>show_by_twiki</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  GET /people/twiki/AndrewCarnegie GET /people/twiki/AndrewCarnegie.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000021-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000021-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 59</span>&#x000A; 59:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_by_twiki</span>&#x000A; 60:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'robots'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">robot?</span>&#x000A; 61:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">get_http_referer</span>()&#x000A; 62:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">contains</span>(<span class="ruby-value str">&quot;info.sv.cmu.edu&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">contains</span>(<span class="ruby-value str">&quot;info.west.cmu.edu&quot;</span>))&#x000A; 63:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">'You don'</span><span class="ruby-value str">'t have permissions to view this data.'</span>&#x000A; 64:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>)&#x000A; 65:       <span class="ruby-keyword kw">return</span>&#x000A; 66:     <span class="ruby-keyword kw">end</span>&#x000A; 67: &#x000A; 68:     <span class="ruby-identifier">twiki_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:twiki_name</span>]&#x000A; 69:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find_by_twiki_name</span>(<span class="ruby-identifier">twiki_name</span>)&#x000A; 70: &#x000A; 71:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">nil?</span>&#x000A; 72:       <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>&#x000A; 73:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">twiki_name</span> = <span class="ruby-identifier">twiki_name</span>&#x000A; 74:       <span class="ruby-identifier">names</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">parse_twiki</span>(<span class="ruby-identifier">twiki_name</span>)&#x000A; 75:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">first_name</span> = <span class="ruby-identifier">names</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">nil?</span>&#x000A; 76:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">last_name</span> = <span class="ruby-identifier">names</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">nil?</span>&#x000A; 77:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">webiso_account</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-comment cmt">#This line probably not necessary since I added it to Person.before_validation</span>&#x000A; 78:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">is_active</span> = <span class="ruby-keyword kw">true</span>&#x000A; 79:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">updated_by_user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logged_in?</span>&#x000A; 80:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">image_uri</span> = <span class="ruby-value str">&quot;/images/mascot.jpg&quot;</span>&#x000A; 81:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">local_near_remote</span> = <span class="ruby-value str">&quot;Unknown&quot;</span>&#x000A; 82:       <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">save</span>&#x000A; 83: &#x000A; 84:       <span class="ruby-constant">GenericMailer</span>.<span class="ruby-identifier">deliver_email</span>(&#x000A; 85:         <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;help@sv.cmu.edu&quot;</span>,&#x000A; 86:         <span class="ruby-identifier">:cc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;todd.sedano@sv.cmu.edu&quot;</span>,&#x000A; 87:         <span class="ruby-identifier">:subject</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;rails user account automatically created for #{twiki_name}&quot;</span>,&#x000A; 88:         <span class="ruby-identifier">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Action Required: update this user's andrew id in the rails database.&lt;br/&gt;&lt;br/&gt;The twiki page for #{twiki_name} was rendered on the twiki server. This page asked rails to generate user data from the rails database. This user did not exist in the rails database, so rails created it.&lt;br/&gt;Note: this person can not edit their own information until their record is updated with their andrew login.&lt;br/&gt;&lt;br/&gt;first_name: #{@person.first_name}&lt;br/&gt;last_name: #{@person.last_name}&lt;br/&gt;email: #{@person.email}&lt;br/&gt;is_active?: #{@person.is_active?}&quot;</span>,&#x000A; 89:         <span class="ruby-identifier">:url_label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Edit this person's information&quot;</span>,&#x000A; 90:         <span class="ruby-identifier">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;http://rails.sv.cmu.edu&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">edit_person_path</span>(<span class="ruby-ivar">@person</span>)&#x000A; 91:       )&#x000A; 92: &#x000A; 93:     <span class="ruby-keyword kw">end</span>&#x000A; 94: &#x000A; 95:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A; 96:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">nil?</span>&#x000A; 97:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-node">&quot;Person #{params[:twiki_name]} is not in this system.&quot;</span>&#x000A; 98:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">people_url</span>)  }&#x000A; 99:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }&#x000A;100:       <span class="ruby-keyword kw">else</span>&#x000A;101:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:html</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>, <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }<span class="ruby-comment cmt"># show.html.erb</span>&#x000A;102:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span> }&#x000A;103:       <span class="ruby-keyword kw">end</span>&#x000A;104:     <span class="ruby-keyword kw">end</span>&#x000A;105:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000025'>
                <a name='M000025'></a>
                <div class='synopsis'>
                  <span class='name'>update</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  PUT /people/1 PUT /people/1.xml
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000025-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000025-source'>     <span class="ruby-comment cmt"># File app/controllers/people_controller.rb, line 167</span>&#x000A;167:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>&#x000A;168: <span class="ruby-comment cmt">#    if !(current_user.is_admin? || current_user.is_staff?)</span>&#x000A;169: <span class="ruby-comment cmt">#      flash[:error] = 'You don''t have permission to do this action.'</span>&#x000A;170: <span class="ruby-comment cmt">#      redirect_to(people_url) and return</span>&#x000A;171: <span class="ruby-comment cmt">#    end</span>&#x000A;172: &#x000A;173:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;174:     <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">updated_by_user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>&#x000A;175: &#x000A;176:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>&#x000A;177:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:person</span>])&#x000A;178:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Person was successfully updated.'</span>&#x000A;179:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@person</span>) }&#x000A;180:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }&#x000A;181:       <span class="ruby-keyword kw">else</span>&#x000A;182:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit&quot;</span> }&#x000A;183:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }&#x000A;184:       <span class="ruby-keyword kw">end</span>&#x000A;185:     <span class="ruby-keyword kw">end</span>&#x000A;186:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
