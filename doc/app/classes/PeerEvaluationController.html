<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: PeerEvaluationController [Rails Application Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          PeerEvaluationController
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/app/controllers/peer_evaluation_controller_rb.html">app/controllers/peer_evaluation_controller.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="ApplicationController.html">ApplicationController</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000203">complete_evaluation</a></li>
              <li><a href="#M000204">complete_evaluation_old</a></li>
              <li><a href="#M000206">complete_report</a></li>
              <li><a href="#M000201">complete_setup</a></li>
              <li><a href="#M000208">create_please_do_evaluation_email</a></li>
              <li><a href="#M000202">edit_evaluation</a></li>
              <li><a href="#M000205">edit_report</a></li>
              <li><a href="#M000200">edit_setup</a></li>
              <li><a href="#M000207">email_reports</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000203'>
                <a name='M000203'></a>
                <div class='synopsis'>
                  <span class='name'>complete_evaluation</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000203-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000203-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 129</span>&#x000A;129:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">complete_evaluation</span>&#x000A;130:     <span class="ruby-ivar">@questions</span> = <span class="ruby-ivar">@@questions</span>&#x000A;131: &#x000A;132:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;133:     <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>&#x000A;134: &#x000A;135:     <span class="ruby-ivar">@author</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)&#x000A;136: &#x000A;137:     <span class="ruby-identifier">personcounter</span> = <span class="ruby-value">0</span>&#x000A;138:     <span class="ruby-identifier">questioncounter</span> = <span class="ruby-value">0</span>&#x000A;139:     <span class="ruby-identifier">alloccounter</span> = <span class="ruby-value">0</span>&#x000A;140: &#x000A;141:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;142:       <span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">question</span><span class="ruby-operator">|</span>&#x000A;143:         <span class="ruby-ivar">@evaluation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">question</span>})&#x000A;144:         <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@evaluation</span>.<span class="ruby-identifier">nil?</span>)&#x000A;145:           <span class="ruby-ivar">@evaluation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">new</span>(&#x000A;146:             <span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>,&#x000A;147:             <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>,&#x000A;148:             <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>,&#x000A;149:             <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">question</span>,&#x000A;150:             <span class="ruby-identifier">:answer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_review</span>][(<span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">*</span><span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">questioncounter</span>).<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:answer</span>],&#x000A;151:             <span class="ruby-identifier">:sequence_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">questioncounter</span>&#x000A;152:           )&#x000A;153:         <span class="ruby-keyword kw">else</span>&#x000A;154:           <span class="ruby-ivar">@evaluation</span>.<span class="ruby-identifier">answer</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_review</span>][(<span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">*</span><span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">questioncounter</span>).<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:answer</span>]&#x000A;155:         <span class="ruby-keyword kw">end</span>&#x000A;156:         <span class="ruby-ivar">@evaluation</span>.<span class="ruby-identifier">save!</span>&#x000A;157:         <span class="ruby-identifier">questioncounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;158:       <span class="ruby-keyword kw">end</span>&#x000A;159:       &#x000A;160:       <span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;161:       <span class="ruby-identifier">questioncounter</span> = <span class="ruby-value">0</span>&#x000A;162:     <span class="ruby-keyword kw">end</span>&#x000A;163: &#x000A;164:       <span class="ruby-identifier">allocAnswer</span> = <span class="ruby-value str">&quot;&quot;</span>&#x000A;165:       <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;166:         <span class="ruby-identifier">allocAnswer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">human_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:allocations</span>][<span class="ruby-identifier">alloccounter</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>&#x000A;167:         <span class="ruby-identifier">alloccounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;168:       <span class="ruby-keyword kw">end</span>&#x000A;169: &#x000A;170:       <span class="ruby-identifier">allocation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@@point_allocation</span>})&#x000A;171:       <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">nil?</span>)&#x000A;172:         <span class="ruby-identifier">allocation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">new</span>(&#x000A;173:           <span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>,&#x000A;174:           <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>,&#x000A;175:           <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@@point_allocation</span>,&#x000A;176:           <span class="ruby-identifier">:answer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">allocAnswer</span>,&#x000A;177:           <span class="ruby-identifier">:sequence_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">questioncounter</span>&#x000A;178:         )&#x000A;179:       <span class="ruby-keyword kw">else</span>&#x000A;180:         <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">answer</span> = <span class="ruby-identifier">allocAnswer</span>&#x000A;181:       <span class="ruby-keyword kw">end</span>&#x000A;182:       <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">save!</span>&#x000A;183: &#x000A;184:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Thank you for completing the peer evaluation form.&quot;</span>&#x000A;185:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">survey_monkey_path</span>(<span class="ruby-ivar">@team</span>.<span class="ruby-identifier">course</span>, <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>))&#x000A;186:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000204'>
                <a name='M000204'></a>
                <div class='synopsis'>
                  <span class='name'>complete_evaluation_old</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000204-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000204-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 188</span>&#x000A;188:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">complete_evaluation_old</span>&#x000A;189:     <span class="ruby-ivar">@questions</span> = <span class="ruby-ivar">@@questions</span>&#x000A;190: &#x000A;191:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;192:     <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>&#x000A;193: &#x000A;194:     <span class="ruby-ivar">@author</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)&#x000A;195: &#x000A;196:     <span class="ruby-identifier">personcounter</span> = <span class="ruby-value">0</span>&#x000A;197:     <span class="ruby-identifier">questioncounter</span> = <span class="ruby-value">0</span>&#x000A;198:     <span class="ruby-identifier">alloccounter</span> = <span class="ruby-value">0</span>&#x000A;199: &#x000A;200:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;201:       <span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">question</span><span class="ruby-operator">|</span>&#x000A;202:         <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">question</span>}).<span class="ruby-identifier">nil?</span>)&#x000A;203:           <span class="ruby-ivar">@evaluation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">new</span>(&#x000A;204:             <span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>,&#x000A;205:             <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>,&#x000A;206:             <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>,&#x000A;207:             <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">question</span>,&#x000A;208:             <span class="ruby-identifier">:answer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_review</span>][(<span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">*</span><span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">questioncounter</span>).<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:answer</span>],&#x000A;209:             <span class="ruby-identifier">:sequence_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">questioncounter</span>&#x000A;210:           )&#x000A;211:         <span class="ruby-keyword kw">else</span>&#x000A;212:           <span class="ruby-ivar">@evaluation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">question</span>})&#x000A;213:           <span class="ruby-ivar">@evaluation</span>.<span class="ruby-identifier">answer</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_review</span>][(<span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">*</span><span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">questioncounter</span>).<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:answer</span>]&#x000A;214:         <span class="ruby-keyword kw">end</span>&#x000A;215:         <span class="ruby-ivar">@evaluation</span>.<span class="ruby-identifier">save!</span>&#x000A;216:         <span class="ruby-identifier">questioncounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;217:       <span class="ruby-keyword kw">end</span>&#x000A;218:       &#x000A;219:       <span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;220:       <span class="ruby-identifier">questioncounter</span> = <span class="ruby-value">0</span>&#x000A;221:     <span class="ruby-keyword kw">end</span>&#x000A;222: &#x000A;223:     <span class="ruby-ivar">@allocAnswer</span> = <span class="ruby-value str">&quot;&quot;</span>&#x000A;224:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;225:       <span class="ruby-ivar">@allocAnswer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">human_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:allocations</span>][<span class="ruby-identifier">alloccounter</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>&#x000A;226:       <span class="ruby-identifier">alloccounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;227:     <span class="ruby-keyword kw">end</span>&#x000A;228: &#x000A;229:     <span class="ruby-ivar">@allocations</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">new</span>(&#x000A;230:       <span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>,&#x000A;231:       <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>,&#x000A;232:       <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Point allocations&quot;</span>,&#x000A;233:       <span class="ruby-identifier">:answer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@allocAnswer</span>,&#x000A;234:       <span class="ruby-identifier">:sequence_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">questioncounter</span>&#x000A;235:     )&#x000A;236:     <span class="ruby-ivar">@allocations</span>.<span class="ruby-identifier">save!</span>&#x000A;237: &#x000A;238:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Thank you for completing the peer evaluation form.&quot;</span>&#x000A;239:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">survey_monkey_path</span>(<span class="ruby-ivar">@team</span>.<span class="ruby-identifier">course</span>, <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>))&#x000A;240:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000206'>
                <a name='M000206'></a>
                <div class='synopsis'>
                  <span class='name'>complete_report</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000206-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000206-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 281</span>&#x000A;281:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">complete_report</span>&#x000A;282:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;283:     <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>&#x000A;284: &#x000A;285:     <span class="ruby-identifier">personcounter</span> = <span class="ruby-value">0</span>&#x000A;286:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;287:       <span class="ruby-comment cmt">#Step 1 save feedback</span>&#x000A;288:       <span class="ruby-identifier">feedback</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_report</span>][<span class="ruby-identifier">personcounter</span>.<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:feedback</span>]&#x000A;289:       <span class="ruby-identifier">report</span> = <span class="ruby-constant">PeerEvaluationReport</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>})&#x000A;290:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">report</span>.<span class="ruby-identifier">nil?</span>&#x000A;291:         <span class="ruby-identifier">report</span> = <span class="ruby-constant">PeerEvaluationReport</span>.<span class="ruby-identifier">new</span>(&#x000A;292:           <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>,&#x000A;293:           <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>,&#x000A;294:           <span class="ruby-identifier">:feedback</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">feedback</span>&#x000A;295:         )&#x000A;296:       <span class="ruby-keyword kw">else</span>&#x000A;297:         <span class="ruby-identifier">report</span>.<span class="ruby-identifier">feedback</span> = <span class="ruby-identifier">feedback</span>&#x000A;298:       <span class="ruby-keyword kw">end</span>&#x000A;299:       <span class="ruby-identifier">report</span>.<span class="ruby-identifier">email_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>&#x000A;300:       <span class="ruby-identifier">report</span>.<span class="ruby-identifier">save!</span>&#x000A;301: &#x000A;302:       <span class="ruby-identifier">faculty</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">faculty_email_addresses</span>()&#x000A;303: &#x000A;304:       <span class="ruby-comment cmt">#Step 2 email feedback</span>&#x000A;305:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:commit</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Save And Email All&quot;</span>&#x000A;306:         <span class="ruby-constant">GenericMailer</span>.<span class="ruby-identifier">deliver_email</span>(&#x000A;307:           <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">email</span>,&#x000A;308:           <span class="ruby-identifier">:subject</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Peer evaluation feedback from team #{@team.name}&quot;</span>,&#x000A;309:           <span class="ruby-identifier">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">feedback</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;\n&quot;</span>, <span class="ruby-value str">&quot;&lt;br/&gt;&quot;</span>),&#x000A;310:           <span class="ruby-identifier">:url_label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>,&#x000A;311:           <span class="ruby-identifier">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>,&#x000A;312: <span class="ruby-comment cmt">#          :from =&gt; current_user.email,  Spam filters block it if the email from is different than the account it is sent from.</span>&#x000A;313:           <span class="ruby-identifier">:cc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">faculty</span>&#x000A;314:         )&#x000A;315:       <span class="ruby-keyword kw">end</span>&#x000A;316: &#x000A;317:       <span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;318:     <span class="ruby-keyword kw">end</span>&#x000A;319: &#x000A;320: &#x000A;321: &#x000A;322:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Reports have been successfully saved.&quot;</span>&#x000A;323:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">survey_monkey_path</span>(<span class="ruby-ivar">@team</span>.<span class="ruby-identifier">course</span>, <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>))&#x000A;324:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000201'>
                <a name='M000201'></a>
                <div class='synopsis'>
                  <span class='name'>complete_setup</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000201-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000201-source'>    <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 30</span>&#x000A;30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">complete_setup</span>&#x000A;31:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;32: &#x000A;33:     <span class="ruby-identifier">counter</span> = <span class="ruby-value">0</span>&#x000A;34: &#x000A;35:     <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">member</span><span class="ruby-operator">|</span>&#x000A;36:       <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">PeerEvaluationLearningObjective</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:person_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">member</span>.<span class="ruby-identifier">id</span>}).<span class="ruby-identifier">nil?</span>)&#x000A;37:         <span class="ruby-ivar">@objective</span> = <span class="ruby-constant">PeerEvaluationLearningObjective</span>.<span class="ruby-identifier">new</span>(&#x000A;38:           <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],&#x000A;39:           <span class="ruby-identifier">:person_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">member</span>.<span class="ruby-identifier">id</span>,&#x000A;40:           <span class="ruby-identifier">:learning_objective</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_learning_objective</span>][<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:learning_objective</span>]&#x000A;41:         )&#x000A;42:       <span class="ruby-keyword kw">else</span>&#x000A;43:         <span class="ruby-ivar">@objective</span> = <span class="ruby-constant">PeerEvaluationLearningObjective</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:person_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">member</span>.<span class="ruby-identifier">id</span>})&#x000A;44:         <span class="ruby-ivar">@objective</span>.<span class="ruby-identifier">learning_objective</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:peer_evaluation_learning_objective</span>][<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">:learning_objective</span>]&#x000A;45:       <span class="ruby-keyword kw">end</span>&#x000A;46: &#x000A;47:       <span class="ruby-ivar">@objective</span>.<span class="ruby-identifier">save!</span>&#x000A;48:       <span class="ruby-identifier">counter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;49:     <span class="ruby-keyword kw">end</span>&#x000A;50: &#x000A;51:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Learning objectives have been updated.&quot;</span>&#x000A;52:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">survey_monkey_path</span>(<span class="ruby-ivar">@team</span>.<span class="ruby-identifier">course</span>, <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>))&#x000A;53:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000208'>
                <a name='M000208'></a>
                <div class='synopsis'>
                  <span class='name'>create_please_do_evaluation_email</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000208-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000208-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 337</span>&#x000A;337:  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_please_do_evaluation_email</span>&#x000A;338: &#x000A;339:      <span class="ruby-identifier">teams</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)&#x000A;340:      <span class="ruby-identifier">emails_sent</span> = <span class="ruby-value">0</span>&#x000A;341:    <span class="ruby-comment cmt">#    teams = Team.find(:all, :conditions =&gt; [&quot;id = ? &quot;, &quot;215&quot;])</span>&#x000A;342:       <span class="ruby-identifier">teams</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">team</span><span class="ruby-operator">|</span>&#x000A;343: <span class="ruby-comment cmt">#        puts &quot;Team: &quot; + team.name + &quot; (&quot; + team.id.to_s + &quot;) &quot;</span>&#x000A;344:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_first_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_second_email</span>.<span class="ruby-identifier">nil?</span>&#x000A;345:           <span class="ruby-identifier">first_date_p</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_first_email</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_first_email</span>.<span class="ruby-identifier">nil?</span>&#x000A;346:           <span class="ruby-identifier">second_date_p</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_second_email</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_second_email</span>.<span class="ruby-identifier">nil?</span>&#x000A;347:           <span class="ruby-keyword kw">if</span> ((<span class="ruby-identifier">first_date_p</span>) <span class="ruby-operator">||</span>&#x000A;348:               (<span class="ruby-identifier">second_date_p</span>))&#x000A;349: &#x000A;350:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Team: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; (&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;) &quot;</span>&#x000A;351:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;First email date: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_first_email</span>.<span class="ruby-identifier">to_s</span>&#x000A;352:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Second email date: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_second_email</span>.<span class="ruby-identifier">to_s</span>&#x000A;353:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Today: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_s</span>&#x000A;354:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;1st comparison is true &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_first_email</span>.<span class="ruby-identifier">to_date</span>&#x000A;355:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;2nd comparison is true &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_second_email</span>.<span class="ruby-identifier">to_date</span>&#x000A;356:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;&quot;</span>&#x000A;357: &#x000A;358:               <span class="ruby-identifier">from_address</span> = <span class="ruby-value str">&quot;scotty.dog@sv.cmu.edu&quot;</span>&#x000A;359:               <span class="ruby-identifier">faculty</span> = <span class="ruby-identifier">team</span>.<span class="ruby-identifier">faculty_email_addresses</span>()&#x000A;360: &#x000A;361:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">first_date_p</span>&#x000A;362:                 <span class="ruby-identifier">to_address</span> = <span class="ruby-identifier">team</span>.<span class="ruby-identifier">email</span>&#x000A;363:                 <span class="ruby-identifier">to_address</span> = []&#x000A;364:                 <span class="ruby-identifier">team</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;365:                   <span class="ruby-identifier">to_address</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">email</span>&#x000A;366:                 <span class="ruby-keyword kw">end</span>&#x000A;367:                 <span class="ruby-identifier">send_email</span>(<span class="ruby-identifier">team</span>, <span class="ruby-identifier">faculty</span>, <span class="ruby-identifier">to_address</span>, <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_message_one</span>)&#x000A;368:                 <span class="ruby-identifier">emails_sent</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;369:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">second_date_p</span>&#x000A;370:                 <span class="ruby-identifier">to_address_done</span> = []&#x000A;371:                 <span class="ruby-identifier">to_address_incomplete</span> = []&#x000A;372:                 <span class="ruby-identifier">team</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;373:                    <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>}).<span class="ruby-identifier">nil?</span>)&#x000A;374:                      <span class="ruby-identifier">to_address_incomplete</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">email</span>&#x000A;375:                    <span class="ruby-keyword kw">else</span>&#x000A;376:                      <span class="ruby-identifier">to_address_done</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">email</span>&#x000A;377:                    <span class="ruby-keyword kw">end</span>&#x000A;378:                 <span class="ruby-keyword kw">end</span>&#x000A;379:                 <span class="ruby-identifier">send_email</span>(<span class="ruby-identifier">team</span>, <span class="ruby-identifier">faculty</span>, <span class="ruby-identifier">to_address_done</span>, <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_message_two_done</span>)&#x000A;380:                 <span class="ruby-identifier">send_email</span>(<span class="ruby-identifier">team</span>, <span class="ruby-identifier">faculty</span>, <span class="ruby-identifier">to_address_incomplete</span>, <span class="ruby-identifier">team</span>.<span class="ruby-identifier">peer_evaluation_message_two_incomplete</span>)&#x000A;381:                 <span class="ruby-identifier">emails_sent</span> <span class="ruby-operator">+=</span> <span class="ruby-value">2</span>&#x000A;382:               <span class="ruby-keyword kw">end</span>&#x000A;383: &#x000A;384:           <span class="ruby-keyword kw">end</span>&#x000A;385:         <span class="ruby-keyword kw">end</span>&#x000A;386:       <span class="ruby-keyword kw">end</span>&#x000A;387: &#x000A;388:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">emails_sent</span>&#x000A;389:  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000202'>
                <a name='M000202'></a>
                <div class='synopsis'>
                  <span class='name'>edit_evaluation</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000202-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000202-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 55</span>&#x000A; 55:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_evaluation</span>&#x000A; 56:     <span class="ruby-ivar">@questions</span> = <span class="ruby-ivar">@@questions</span>&#x000A; 57:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A; 58:     <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>&#x000A; 59:     <span class="ruby-ivar">@author</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)&#x000A; 60:     <span class="ruby-ivar">@answers</span> = []&#x000A; 61:     <span class="ruby-ivar">@point_allocations</span> = {}&#x000A; 62:     <span class="ruby-ivar">@review</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">new</span>&#x000A; 63: &#x000A; 64:     <span class="ruby-ivar">@on_team</span> = <span class="ruby-keyword kw">false</span>&#x000A; 65:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A; 66:       <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">person</span>.<span class="ruby-identifier">human_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">human_name</span>)&#x000A; 67:         <span class="ruby-ivar">@on_team</span> = <span class="ruby-keyword kw">true</span>&#x000A; 68:       <span class="ruby-keyword kw">end</span>&#x000A; 69:     <span class="ruby-keyword kw">end</span>&#x000A; 70: &#x000A; 71:     <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@on_team</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>)&#x000A; 72:       <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_staff</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin</span>)&#x000A; 73:         <span class="ruby-keyword kw">return</span>&#x000A; 74:       <span class="ruby-keyword kw">end</span>&#x000A; 75:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-node">&quot;You are not on team #{@team.name}&quot;</span>&#x000A; 76:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">survey_monkey_path</span>(<span class="ruby-ivar">@team</span>.<span class="ruby-identifier">course</span>, <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>))&#x000A; 77:       <span class="ruby-keyword kw">return</span>&#x000A; 78:     <span class="ruby-keyword kw">end</span>&#x000A; 79: &#x000A; 80:     <span class="ruby-identifier">personcounter</span> = <span class="ruby-value">0</span>&#x000A; 81:     <span class="ruby-identifier">questioncounter</span> = <span class="ruby-value">0</span>&#x000A; 82:     <span class="ruby-identifier">alloccounter</span> = <span class="ruby-value">0</span>&#x000A; 83: &#x000A; 84:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A; 85:       <span class="ruby-ivar">@questions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">question</span><span class="ruby-operator">|</span>&#x000A; 86:         <span class="ruby-identifier">evaluation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:recipient_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">question</span>})&#x000A; 87:         <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">evaluation</span>.<span class="ruby-identifier">nil?</span>)&#x000A; 88:           <span class="ruby-ivar">@answers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&quot;</span>&#x000A; 89:         <span class="ruby-keyword kw">else</span>&#x000A; 90:           <span class="ruby-ivar">@answers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">evaluation</span>.<span class="ruby-identifier">answer</span>&#x000A; 91:         <span class="ruby-keyword kw">end</span>&#x000A; 92:         <span class="ruby-identifier">questioncounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A; 93:       <span class="ruby-keyword kw">end</span>&#x000A; 94: &#x000A; 95:       <span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A; 96:       <span class="ruby-identifier">questioncounter</span> = <span class="ruby-value">0</span>&#x000A; 97:     <span class="ruby-keyword kw">end</span>&#x000A; 98: &#x000A; 99:    <span class="ruby-identifier">allocation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@@point_allocation</span>})&#x000A;100:    <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">answer</span>.<span class="ruby-identifier">nil?</span>&#x000A;101:     <span class="ruby-identifier">match_array</span> = <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">answer</span>.<span class="ruby-identifier">scan</span> <span class="ruby-regexp re">/((\w| )*):(\d*)\s*/</span>&#x000A;102:    <span class="ruby-identifier">match_array</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>&#x000A;103:      <span class="ruby-identifier">name</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">0</span>]&#x000A;104:      <span class="ruby-identifier">points</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">2</span>]&#x000A;105:      <span class="ruby-ivar">@point_allocations</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">points</span>&#x000A;106:    <span class="ruby-keyword kw">end</span>&#x000A;107:   <span class="ruby-keyword kw">end</span>&#x000A;108: &#x000A;109:     <span class="ruby-comment cmt">#    @allocAnswer = &quot;&quot;</span>&#x000A;110: <span class="ruby-comment cmt">#    @people.each do |person|</span>&#x000A;111: <span class="ruby-comment cmt">#      @allocAnswer &lt;&lt; person.human_name + &quot;:&quot; + params[:allocations][alloccounter] + &quot; &quot;</span>&#x000A;112: <span class="ruby-comment cmt">#      alloccounter += 1</span>&#x000A;113: <span class="ruby-comment cmt">#    end</span>&#x000A;114: <span class="ruby-comment cmt">#</span>&#x000A;115: <span class="ruby-comment cmt">#    @allocations = PeerEvaluationReview.new(</span>&#x000A;116: <span class="ruby-comment cmt">#      :author_id =&gt; @author.id,</span>&#x000A;117: <span class="ruby-comment cmt">#      :team_id =&gt; @team.id,</span>&#x000A;118: <span class="ruby-comment cmt">#      :question =&gt; &quot;Point allocations&quot;,</span>&#x000A;119: <span class="ruby-comment cmt">#      :answer =&gt; @allocAnswer,</span>&#x000A;120: <span class="ruby-comment cmt">#      :sequence_number =&gt; questioncounter</span>&#x000A;121: <span class="ruby-comment cmt">#    )</span>&#x000A;122: <span class="ruby-comment cmt">#    @allocations.save!</span>&#x000A;123: &#x000A;124: &#x000A;125: &#x000A;126:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000205'>
                <a name='M000205'></a>
                <div class='synopsis'>
                  <span class='name'>edit_report</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000205-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000205-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 242</span>&#x000A;242:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_report</span>&#x000A;243:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;244:     <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>&#x000A;245: &#x000A;246:     <span class="ruby-ivar">@report</span> = <span class="ruby-constant">PeerEvaluationReport</span>.<span class="ruby-identifier">new</span>&#x000A;247: &#x000A;248:     <span class="ruby-ivar">@incompletes</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>&#x000A;249:     <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">member</span><span class="ruby-operator">|</span>&#x000A;250:       <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">member</span>.<span class="ruby-identifier">id</span>}).<span class="ruby-identifier">nil?</span>)&#x000A;251:         <span class="ruby-ivar">@incompletes</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">member</span>)&#x000A;252:       <span class="ruby-keyword kw">end</span>&#x000A;253:     <span class="ruby-keyword kw">end</span>&#x000A;254: &#x000A;255:     <span class="ruby-ivar">@reportArray</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@people</span>.<span class="ruby-identifier">size</span>)&#x000A;256:     <span class="ruby-identifier">personcounter</span> = <span class="ruby-value">0</span>&#x000A;257:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;258:       <span class="ruby-ivar">@reportArray</span>[<span class="ruby-identifier">personcounter</span>] = <span class="ruby-identifier">generate_report_for_student</span>(<span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>)&#x000A;259:       <span class="ruby-identifier">personcounter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;260:     <span class="ruby-keyword kw">end</span>&#x000A;261: &#x000A;262:     <span class="ruby-ivar">@report_allocations</span> = {}&#x000A;263:     <span class="ruby-ivar">@point_allocations</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = {} }  <span class="ruby-comment cmt">#two dimensional hash</span>&#x000A;264:     <span class="ruby-ivar">@people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>&#x000A;265:        <span class="ruby-identifier">tmp</span> = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">human_name</span>&#x000A;266:        <span class="ruby-identifier">allocation</span> = <span class="ruby-constant">PeerEvaluationReview</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:question</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@@point_allocation</span>})&#x000A;267:        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">nil?</span>&#x000A;268:           <span class="ruby-ivar">@report_allocations</span>[<span class="ruby-identifier">person</span>.<span class="ruby-identifier">human_name</span>] = <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">answer</span>&#x000A;269: &#x000A;270:       <span class="ruby-identifier">match_array</span> = <span class="ruby-identifier">allocation</span>.<span class="ruby-identifier">answer</span>.<span class="ruby-identifier">scan</span> <span class="ruby-regexp re">/((\w| )*):(\d*)\s*/</span>&#x000A;271:        <span class="ruby-identifier">match_array</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>&#x000A;272:          <span class="ruby-identifier">name</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">0</span>]&#x000A;273:          <span class="ruby-identifier">points</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">2</span>]&#x000A;274:          <span class="ruby-ivar">@point_allocations</span>[<span class="ruby-identifier">person</span>.<span class="ruby-identifier">human_name</span>][<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">points</span>&#x000A;275:        <span class="ruby-keyword kw">end</span>&#x000A;276:       <span class="ruby-keyword kw">end</span>&#x000A;277:     <span class="ruby-keyword kw">end</span>&#x000A;278: &#x000A;279:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000200'>
                <a name='M000200'></a>
                <div class='synopsis'>
                  <span class='name'>edit_setup</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000200-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000200-source'>    <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 13</span>&#x000A;13:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_setup</span>&#x000A;14:     <span class="ruby-ivar">@team</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])&#x000A;15:     <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>&#x000A;16: &#x000A;17:     <span class="ruby-ivar">@objective</span> = <span class="ruby-constant">PeerEvaluationLearningObjective</span>.<span class="ruby-identifier">new</span>&#x000A;18: &#x000A;19:     <span class="ruby-ivar">@objectives</span> = []&#x000A;20:     <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">member</span><span class="ruby-operator">|</span>&#x000A;21:        <span class="ruby-identifier">objective</span> = <span class="ruby-constant">PeerEvaluationLearningObjective</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:team_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@team</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:person_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">member</span>.<span class="ruby-identifier">id</span>})&#x000A;22:        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">objective</span>.<span class="ruby-identifier">nil?</span>&#x000A;23:          <span class="ruby-ivar">@objectives</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">PeerEvaluationLearningObjective</span>.<span class="ruby-identifier">new</span>&#x000A;24:        <span class="ruby-keyword kw">else</span>&#x000A;25:         <span class="ruby-ivar">@objectives</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">objective</span>&#x000A;26:        <span class="ruby-keyword kw">end</span>&#x000A;27:     <span class="ruby-keyword kw">end</span>&#x000A;28:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000207'>
                <a name='M000207'></a>
                <div class='synopsis'>
                  <span class='name'>email_reports</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000207-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000207-source'>     <span class="ruby-comment cmt"># File app/controllers/peer_evaluation_controller.rb, line 327</span>&#x000A;327:  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">email_reports</span>&#x000A;328: &#x000A;329: &#x000A;330: &#x000A;331:  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
